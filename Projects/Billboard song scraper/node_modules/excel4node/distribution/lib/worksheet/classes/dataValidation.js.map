{"version":3,"sources":["../../../../source/lib/worksheet/classes/dataValidation.js"],"names":["myUtils","require","cleanFormula","f","substr","DataValidation","opts","sqref","undefined","TypeError","formulas","Array","formula1","formula2","allowBlank","parseInt","errorStyle","enums","indexOf","join","error","showErrorMessage","errorTitle","imeMode","operator","prompt","showInputMessage","promptTitle","showDropDown","type","ele","valEle","att","boolToInt","text","up","DataValidationCollection","items","thisValidation","push","valsEle","length","forEach","val","addToXMLele","module","exports"],"mappings":"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","file":"dataValidation.js","sourcesContent":["const myUtils = require('../../utils.js');\n\nlet cleanFormula = (f) => {\n    if (typeof f === 'number' || f.substr(0, 1) === '=') {\n        return f;\n    } else {\n        return '\"' + f + '\"';\n    }\n};\n\nclass DataValidation { // ยง18.3.1.32 dataValidation (Data Validation)\n    constructor(opts) {\n        opts = opts ? opts : {};\n        if (opts.sqref === undefined) {\n            throw new TypeError('sqref must be specified when creating a DataValidation instance.');\n        }\n        this.sqref = opts.sqref;\n        if (opts.formulas instanceof Array) {\n            opts.formulas[0] !== undefined ? this.formula1 = opts.formulas[0] : null;\n            opts.formulas[1] !== undefined ? this.formula2 = opts.formulas[1] : null;\n        }\n\n        if (opts.allowBlank !== undefined) {\n            if (parseInt(opts.allowBlank) === 1) {\n                opts.allowBlank = true;\n            }\n            if (parseInt(opts.allowBlank) === 0) {\n                opts.allowBlank = false;\n            }\n            if (typeof opts.allowBlank !== 'boolean') {\n                throw new TypeError('DataValidation allowBlank must be true, false, 1 or 0');\n            }\n            this.allowBlank = opts.allowBlank; \n        }\n\n        if (opts.errorStyle !== undefined) {\n            let enums = ['stop', 'warning', 'information'];\n            if (enums.indexOf(opts.errorStyle) < 0) {\n                throw new TypeError('DataValidation errorStyle must be one of ' + enums.join(', '));\n            }\n            this.errorStyle = opts.errorStyle;\n        }\n\n        if (opts.error !== undefined) {\n            if (typeof opts.error !== 'string') {\n                throw new TypeError('DataValidation error must be a string');\n            }\n            this.error = opts.error;\n            this.showErrorMessage = opts.showErrorMessage = true;\n        }\n\n        if (opts.errorTitle !== undefined) {\n            if (typeof opts.errorTitle !== 'string') {\n                throw new TypeError('DataValidation errorTitle must be a string');\n            }\n            this.errorTitle = opts.errorTitle;\n            this.showErrorMessage = opts.showErrorMessage = true;\n        }\n\n        if (opts.imeMode !== undefined) {\n            let enums = ['noControl', 'off', 'on', 'disabled', 'hiragana', 'fullKatakana', 'halfKatakana', 'fullAlpha', 'halfAlpha', 'fullHangul', 'halfHangul'];\n            if (enums.indexOf(opts.imeMode) < 0) {\n                throw new TypeError('DataValidation imeMode must be one of ' + enums.join(', '));\n            }\n            this.imeMode = opts.imeMode;\n        }\n            \n        if (opts.operator !== undefined) {\n            let enums = ['between', 'notBetween', 'equal', 'notEqual', 'lessThan', 'lessThanOrEqual', 'greaterThan', 'greaterThanOrEqual'];\n            if (enums.indexOf(opts.operator) < 0) {\n                throw new TypeError('DataValidation operator must be one of ' + enums.join(', '));\n            }\n            this.operator = opts.operator;\n        }\n\n        if (opts.prompt !== undefined) {\n            if (typeof opts.prompt !== 'string') {\n                throw new TypeError('DataValidation prompt must be a string');\n            }\n            this.prompt = opts.prompt;\n            this.showInputMessage = opts.showInputMessage = true;\n        }\n\n        if (opts.promptTitle !== undefined) {\n            if (typeof opts.promptTitle !== 'string') {\n                throw new TypeError('DataValidation promptTitle must be a string');\n            }\n            this.promptTitle = opts.promptTitle;\n            this.showInputMessage = opts.showInputMessage = true;\n        }\n\n        if (opts.showDropDown !== undefined) {\n            if (parseInt(opts.showDropDown) === 1) {\n                opts.showDropDown = true;\n            }\n            if (parseInt(opts.showDropDown) === 0) {\n                opts.showDropDown = false;\n            }\n            if (typeof opts.showDropDown !== 'boolean') {\n                throw new TypeError('DataValidation showDropDown must be true, false, 1 or 0');\n            }\n            this.showDropDown = opts.showDropDown;\n        }\n\n        if (opts.showErrorMessage !== undefined) {\n            if (parseInt(opts.showErrorMessage) === 1) {\n                opts.showErrorMessage = true;\n            }\n            if (parseInt(opts.showErrorMessage) === 0) {\n                opts.showErrorMessage = false;\n            }\n            if (typeof opts.showErrorMessage !== 'boolean') {\n                throw new TypeError('DataValidation showErrorMessage must be true, false, 1 or 0');\n            }\n            this.showErrorMessage = opts.showErrorMessage;\n        }\n\n        if (opts.showInputMessage !== undefined) {\n            if (parseInt(opts.showInputMessage) === 1) {\n                opts.showInputMessage = true;\n            }\n            if (parseInt(opts.showInputMessage) === 0) {\n                opts.showInputMessage = false;\n            }\n            if (typeof opts.showInputMessage !== 'boolean') {\n                throw new TypeError('DataValidation showInputMessage must be true, false, 1 or 0');\n            }\n            this.showInputMessage = opts.showInputMessage;\n        }\n\n        if (opts.type !== undefined) {\n            let enums = ['none', 'whole', 'decimal', 'list', 'date', 'time', 'textLength', 'custom'];\n            if (enums.indexOf(opts.type) < 0) {\n                throw new TypeError('DataValidation type must be one of ' + enums.join(', '));\n            }\n            this.type = opts.type;\n        }\n    }\n\n    addToXMLele(ele) {\n        let valEle = ele.ele('dataValidation');\n        this.type !== undefined ? valEle.att('type', this.type) : null;\n        this.errorStyle !== undefined ? valEle.att('errorStyle', this.errorStyle) : null;\n        this.imeMode !== undefined ? valEle.att('imeMode', this.imeMode) : null;\n        this.operator !== undefined ? valEle.att('operator', this.operator) : null;\n        this.allowBlank !== undefined ? valEle.att('allowBlank', myUtils.boolToInt(this.allowBlank)) : null;\n        this.showDropDown === false ? valEle.att('showDropDown', 1) : null; // For some reason, the Excel app sets this property to true if the \"In-cell dropdown\" option is selected in the data validation screen.\n        this.showInputMessage !== undefined ? valEle.att('showInputMessage', myUtils.boolToInt(this.showInputMessage)) : null;\n        this.showErrorMessage !== undefined ? valEle.att('showErrorMessage', myUtils.boolToInt(this.showErrorMessage)) : null;\n        this.errorTitle !== undefined ? valEle.att('errorTitle', this.errorTitle) : null;\n        this.error !== undefined ? valEle.att('error', this.error) : null;\n        this.promptTitle !== undefined ? valEle.att('promptTitle', this.promptTitle) : null;\n        this.prompt !== undefined ? valEle.att('prompt', this.prompt) : null;\n        this.sqref !== undefined ? valEle.att('sqref', this.sqref) : null;\n        if (this.formula1 !== undefined) {\n            valEle.ele('formula1').text(cleanFormula(this.formula1));\n            valEle.up();\n            if (this.formula2 !== undefined) {\n                valEle.ele('formula2').text(cleanFormula(this.formula2));\n                valEle.up();\n            }\n        }\n        valEle.up();\n    }\n}\n\nclass DataValidationCollection { // ยง18.3.1.33 dataValidations (Data Validations)\n    constructor(opts) {\n        opts = opts ? opts : {};\n        this.items = [];\n    }\n\n    get length() {\n        return this.items.length;\n    }\n\n    add(opts) {\n        let thisValidation = new DataValidation(opts);\n        this.items.push(thisValidation);\n        return thisValidation;\n    }\n\n    addToXMLele(ele) {\n        let valsEle = ele.ele('dataValidations').att('count', this.length);\n        this.items.forEach((val) => {\n            val.addToXMLele(valsEle);\n        });\n        valsEle.up();\n    }\n}\n\nmodule.exports = { DataValidationCollection, DataValidation };\n"]}